From 570bb64327630a7da2747c62216364b9b37069cc Mon Sep 17 00:00:00 2001
From: SATOH Fumiyasu <fumiyas@osstech.co.jp>
Date: Fri, 11 Apr 2014 15:29:10 +0900
Subject: [PATCH] Add mlist.real_name to the subject in a notice message

---
 Mailman/Bouncer.py                 |  5 +++--
 Mailman/Handlers/MimeDel.py        |  3 ++-
 Mailman/Handlers/Moderate.py       |  3 ++-
 Mailman/Queue/BounceRunner.py      |  3 ++-
 messages/ja/LC_MESSAGES/mailman.po | 16 ++++++++--------
 5 files changed, 17 insertions(+), 13 deletions(-)

diff --git a/Mailman/Bouncer.py b/Mailman/Bouncer.py
index 29fe4ea..ab90d43 100644
--- a/Mailman/Bouncer.py
+++ b/Mailman/Bouncer.py
@@ -225,9 +225,10 @@ class Bouncer:
         # meaningless strings for the unused %()s fields so that the language
         # translators don't have to provide new templates.
         siteowner = Utils.get_site_email(self.host_name)
+        realname = self.real_name
         text = Utils.maketext(
             'bounce.txt',
-            {'listname' : self.real_name,
+            {'listname' : realname,
              'addr'     : member,
              'negative' : '',
              'did'      : _('disabled'),
@@ -235,7 +236,7 @@ class Bouncer:
              'reenable' : '',
              'owneraddr': siteowner,
              }, mlist=self)
-        subject = _('Bounce action notification')
+        subject = _('%(realname)s bounce action notification')
         umsg = Message.UserNotification(self.GetOwnerEmail(),
                                         siteowner, subject,
                                         lang=self.preferred_language)
diff --git a/Mailman/Handlers/MimeDel.py b/Mailman/Handlers/MimeDel.py
index ab7483b..de775c1 100644
--- a/Mailman/Handlers/MimeDel.py
+++ b/Mailman/Handlers/MimeDel.py
@@ -259,6 +259,7 @@ def dispose(mlist, msg, msgdata, why):
     if mlist.filter_action == 2:
         # Forward it on to the list owner
         listname = mlist.internal_name()
+        realname = mlist.real_name
         mlist.ForwardMessage(
             msg,
             text=_("""\
@@ -267,7 +268,7 @@ rules and was prevented from being forwarded on to the list membership.  You
 are receiving the only remaining copy of the discarded message.
 
 """),
-            subject=_('Content filtered message notification'))
+            subject=_('%(realname)s content filtered message notification'))
     if mlist.filter_action == 3 and \
            mm_cfg.OWNERS_CAN_PRESERVE_FILTERED_MESSAGES:
         badq = get_switchboard(mm_cfg.BADQUEUE_DIR)
diff --git a/Mailman/Handlers/Moderate.py b/Mailman/Handlers/Moderate.py
index 42dffb8..b00a495 100644
--- a/Mailman/Handlers/Moderate.py
+++ b/Mailman/Handlers/Moderate.py
@@ -174,9 +174,10 @@ def do_discard(mlist, msg):
         lang = mlist.preferred_language
         varhelp = '%s/?VARHELP=privacy/sender/discard_these_nonmembers' % \
                   mlist.GetScriptURL('admin', absolute=1)
+        realname = mlist.real_name
         nmsg = Message.UserNotification(mlist.GetOwnerEmail(),
                                         mlist.GetBouncesEmail(),
-                                        _('Auto-discard notification'),
+                                        _('%(realname)s auto-discard notification'),
                                         lang=lang)
         nmsg.set_type('multipart/mixed')
         text = MIMEText(Utils.wrap(_(
diff --git a/Mailman/Queue/BounceRunner.py b/Mailman/Queue/BounceRunner.py
index fcd6e3f..e3e0020 100644
--- a/Mailman/Queue/BounceRunner.py
+++ b/Mailman/Queue/BounceRunner.py
@@ -339,6 +339,7 @@ def maybe_forward(mlist, msg):
     # If not, simply discard it.
     if mlist.bounce_unrecognized_goes_to_list_owner:
         adminurl = mlist.GetScriptURL('admin', absolute=1) + '/bounce'
+        realname = mlist.real_name
         mlist.ForwardMessage(msg,
                              text=_("""\
 The attached message was received as a bounce, but either the bounce format
@@ -350,7 +351,7 @@ For more information see:
 %(adminurl)s
 
 """),
-                             subject=_('Uncaught bounce notification'),
+                             subject=_('%(realname)s uncaught bounce notification'),
                              tomoderators=0)
         syslog('bounce',
                '%s: forwarding unrecognized, message-id: %s',
diff --git a/messages/ja/LC_MESSAGES/mailman.po b/messages/ja/LC_MESSAGES/mailman.po
index 8bab795..15e3b07 100755
--- a/messages/ja/LC_MESSAGES/mailman.po
+++ b/messages/ja/LC_MESSAGES/mailman.po
@@ -214,8 +214,8 @@ msgid "disabled"
 msgstr "配送停止"
 
 #: Mailman/Bouncer.py:238
-msgid "Bounce action notification"
-msgstr "配送エラー処理通知"
+msgid "%(realname)s bounce action notification"
+msgstr "%(realname)s 配送エラー処理通知"
 
 #: Mailman/Bouncer.py:293
 msgid " The last bounce received from you was dated %(date)s"
@@ -7494,8 +7494,8 @@ msgstr ""
 "破棄されなかった部分だけを配信します.\n"
 
 #: Mailman/Handlers/MimeDel.py:270
-msgid "Content filtered message notification"
-msgstr "添付ファイル削除通知"
+msgid "%(realname)s content filtered message notification"
+msgstr "%(realname)s 添付ファイル削除通知"
 
 #: Mailman/Handlers/Moderate.py:163
 msgid ""
@@ -7509,8 +7509,8 @@ msgstr ""
 "メーリングリスト管理者 %(listowner)s 宛にご連絡ください."
 
 #: Mailman/Handlers/Moderate.py:179
-msgid "Auto-discard notification"
-msgstr "自動破棄通知"
+msgid "%(realname)s auto-discard notification"
+msgstr "%(realname)s 自動破棄通知"
 
 #: Mailman/Handlers/Moderate.py:182
 msgid "The attached message has been automatically discarded."
@@ -7842,8 +7842,8 @@ msgstr ""
 "\n"
 
 #: Mailman/Queue/BounceRunner.py:353
-msgid "Uncaught bounce notification"
-msgstr "自動配送エラー処理の例外通知"
+msgid "%(realname)s uncaught bounce notification"
+msgstr "%(realname)s 自動配送エラー処理の例外通知"
 
 #: Mailman/Queue/CommandRunner.py:97
 msgid "Ignoring non-text/plain MIME parts"
-- 
1.9.1

